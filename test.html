<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <title>وب‌اپ مانتو فروشی با فیلتر رنگ و سایز</title>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      background-color: #f5f7fa;
      margin: 0;
      padding: 20px;
      font-size: 18px;
    }
    .section {
      background-color: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: 0 auto 30px;
    }
    .section h2 {
      margin-top: 0;
      color: #333;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"], input[type="number"], input[type="file"], select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 18px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
    }
    button:hover {
      background-color: #004a99;
    }
    .manto-list {
      margin-top: 20px;
    }
    .manto-item {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    .manto-item:hover {
      background-color: #f0f0f0;
    }
    .details {
      margin-top: 10px;
      font-size: 16px;
      color: #555;
    }
    #manageSection div {
      margin-bottom: 10px;
    }
    #manageSection button {
      margin-right: 10px;
      padding: 2px 10px;
    }
    img.preview {
      width: 100%;
      height: auto;
      max-height: none;
      object-fit: contain;
      margin-top: 10px;
      border-radius: 8px;
      aspect-ratio: 2/3;
    }
    .size-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .size-grid label {
      width: 80px;
    }
    /* استایل چک‌باکس‌های سایز */
    #sizeCheckboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 5px;
    }
    #sizeCheckboxes label {
      cursor: pointer;
      user-select: none;
      font-weight: normal;
    }
    /* منوی رنگ */
    #colorFilter {
      margin-top: 15px;
      width: 100%;
      padding: 10px;
      font-size: 18px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    /* عنوان موجودی سایز در فرم افزودن */
    #addForm .size-title {
      font-weight: bold;
      font-size: 20px;
      margin-top: 20px;
      margin-bottom: 10px;
      color: #333;
    }
  </style>
</head>
<body>

  <!-- جستجو -->
  <div class="section">
    <h2>جستجوی مانتو</h2>
    <label>فیلتر بر اساس سایز:</label>
    <div id="sizeCheckboxes">
      <label><input type="checkbox" value="36" /> ۳۶</label>
      <label><input type="checkbox" value="37" /> ۳۷</label>
      <label><input type="checkbox" value="40" /> ۴۰</label>
      <label><input type="checkbox" value="42" /> ۴۲</label>
      <label><input type="checkbox" value="44" /> ۴۴</label>
      <label><input type="checkbox" value="46" /> ۴۶</label>
      <label><input type="checkbox" value="48" /> ۴۸</label>
      <label><input type="checkbox" value="50" /> ۵۰</label>
      <label><input type="checkbox" value="52" /> ۵۲</label>
      <label><input type="checkbox" value="54" /> ۵۴</label>
      <label><input type="checkbox" value="2" /> ۲</label>
      <label><input type="checkbox" value="4" /> ۴</label>
      <label><input type="checkbox" value="6" /> ۶</label>
      <label><input type="checkbox" value="8" /> ۸</label>
    </div>

    <label for="colorFilter">فیلتر بر اساس رنگ:</label>
    <select id="colorFilter">
      <option value="">همه رنگ‌ها</option>
      <option value="مشکی">مشکی</option>
      <option value="سرمه‌ای">سرمه‌ای</option>
      <option value="طوسی">طوسی</option>
      <option value="ذغالی">ذغالی</option>
      <option value="قهوه‌ای">قهوه‌ای</option>
      <option value="سبز">سبز</option>
      <option value="کرم">کرم</option>
      <option value="آبی">آبی</option>
      <option value="سایر">سایر</option>
    </select>

    <div class="manto-list" id="mantoList"></div>
  </div>

  <!-- مدیریت مانتوها -->
  <div class="section">
    <h2>مدیریت مانتوها</h2>
    <label for="manageSelect">انتخاب مانتو:</label>
    <select id="manageSelect">
      <option value="">-- انتخاب مانتو --</option>
    </select>
    <div id="manageSection" style="margin-top: 20px; display: none;">
      <img id="managePhoto" class="preview" src="" alt="نمایش عکس" />
      <h3>موجودی سایزها:</h3>
      <div id="sizeControls"></div>
      <button id="saveChangesBtn" style="background-color: green; color: white; margin-top: 20px;">ثبت تغییرات</button>
    </div>
  </div>

  <!-- افزودن مانتو -->
  <div class="section">
    <h2>افزودن مانتو</h2>
    <form id="addForm">
      <label for="photo">عکس مانتو:</label>
      <input type="file" id="photo" accept="image/*" />

      <label for="name">نام مانتو:</label>
      <input type="text" id="name" />

      <label for="code">کد مانتو:</label>
      <input type="text" id="code" />

      <label for="price">قیمت مانتو (تومان):</label>
      <input type="number" id="price" />

      <label for="color">رنگ مانتو:</label>
      <select id="color">
        <option>مشکی</option>
        <option>سرمه‌ای</option>
        <option>طوسی</option>
        <option>ذغالی</option>
        <option>قهوه‌ای</option>
        <option>سبز</option>
        <option>کرم</option>
        <option>آبی</option>
        <option>سایر</option>
      </select>

      <!-- عنوان موجودی سایز اضافه شده -->
      <div class="size-title">موجودی هر سایز:</div>

      <div class="size-grid">
        <label>سایز ۳۶:<input type="number" id="size36" min="0" /></label>
        <label>سایز ۳۷:<input type="number" id="size37" min="0" /></label>
        <label>سایز ۴۰:<input type="number" id="size40" min="0" /></label>
        <label>سایز ۴۲:<input type="number" id="size42" min="0" /></label>
        <label>سایز ۴۴:<input type="number" id="size44" min="0" /></label>
        <label>سایز ۴۶:<input type="number" id="size46" min="0" /></label>
        <label>سایز ۴۸:<input type="number" id="size48" min="0" /></label>
        <label>سایز ۵۰:<input type="number" id="size50" min="0" /></label>
        <label>سایز ۵۲:<input type="number" id="size52" min="0" /></label>
        <label>سایز ۵۴:<input type="number" id="size54" min="0" /></label>
        <label>سایز ۲:<input type="number" id="size2" min="0" /></label>
        <label>سایز ۴:<input type="number" id="size4" min="0" /></label>
        <label>سایز ۶:<input type="number" id="size6" min="0" /></label>
        <label>سایز ۸:<input type="number" id="size8" min="0" /></label>
      </div>

      <button type="submit">ثبت مانتو</button>
    </form>
  </div>

  <script>
    const form = document.getElementById("addForm");
    const mantoList = document.getElementById("mantoList");
    const sizeCheckboxes = document.getElementById("sizeCheckboxes");
    const colorFilter = document.getElementById("colorFilter");
    const manageSelect = document.getElementById("manageSelect");
    const manageSection = document.getElementById("manageSection");
    const sizeControls = document.getElementById("sizeControls");
    const managePhoto = document.getElementById("managePhoto");
    const saveChangesBtn = document.getElementById("saveChangesBtn");
    let mantos = [];

    // افزودن مانتو جدید
    form.addEventListener("submit", function(e) {
      e.preventDefault();
      const file = document.getElementById("photo").files[0];
      if (!file) {
        alert("لطفاً یک عکس مانتو انتخاب کنید.");
        return;
      }
      const reader = new FileReader();
      reader.onload = function() {
        const sizes = {};
        ["36","37","40","42","44","46","48","50","52","54","2","4","6","8"].forEach(size => {
          sizes[size] = parseInt(document.getElementById("size" + size).value) || 0;
        });

        const manto = {
          photo: reader.result,
          name: document.getElementById("name").value.trim(),
          code: document.getElementById("code").value.trim(),
          price: parseInt(document.getElementById("price").value),
          color: document.getElementById("color").value,
          sizes: sizes
        };

        if (!manto.name || !manto.code || isNaN(manto.price)) {
          alert("لطفاً همه فیلدهای نام، کد و قیمت را پر کنید.");
          return;
        }

        mantos.push(manto);
        updateManageDropdown();
        showMantos();
        form.reset();
      };
      reader.readAsDataURL(file);
    });

    // نمایش مانتوها با فیلتر سایز و رنگ
    function showMantos() {
      const selectedSizes = Array.from(sizeCheckboxes.querySelectorAll("input[type=checkbox]:checked")).map(cb => cb.value);
      const selectedColor = colorFilter.value.trim();

      if (selectedSizes.length === 0) {
        mantoList.innerHTML = "<p>لطفاً حداقل یک سایز انتخاب کنید.</p>";
        return;
      }

      let foundAny = false;
      mantoList.innerHTML = "";
      mantos.forEach((manto, idx) => {
        if ((selectedColor === "" || manto.color === selectedColor) &&
          selectedSizes.some(size => manto.sizes[size] && manto.sizes[size] > 0)) {
          foundAny = true;
          const div = document.createElement("div");
          div.className = "manto-item";
          div.innerHTML = `
            <img src="${manto.photo}" alt="عکس مانتو" style="width:100%; max-height: 300px; object-fit: contain; border-radius: 8px;" />
            <h3>${manto.name}</h3>
            <p>کد: ${manto.code}</p>
            <p>قیمت: ${manto.price.toLocaleString()} تومان</p>
            <p>رنگ: ${manto.color}</p>
            <div class="details" style="display:none; margin-top: 10px;">
              ${Object.entries(manto.sizes).map(([s,v]) => `سایز ${s}: ${v}`).join('<br>')}
            </div>
          `;
          div.addEventListener("click", () => {
            const details = div.querySelector(".details");
            details.style.display = details.style.display === "none" ? "block" : "none";
          });
          mantoList.appendChild(div);
        }
      });
      if (!foundAny) {
        mantoList.innerHTML = "<p>هیچ مانتویی با فیلترهای انتخاب شده یافت نشد.</p>";
      }
    }

    // به‌روزرسانی گزینه‌های انتخاب مانتو در بخش مدیریت
    function updateManageDropdown() {
      manageSelect.innerHTML = '<option value="">-- انتخاب مانتو --</option>';
      mantos.forEach((manto, idx) => {
        const option = document.createElement("option");
        option.value = idx;
        option.textContent = manto.name + " (" + manto.code + ")";
        manageSelect.appendChild(option);
      });
    }

    // وقتی مانتو در بخش مدیریت انتخاب شد
    manageSelect.addEventListener("change", function() {
      const idx = this.value;
      if (idx === "") {
        manageSection.style.display = "none";
        return;
      }
      manageSection.style.display = "block";
      const manto = mantos[idx];
      managePhoto.src = manto.photo;
      sizeControls.innerHTML = "";

      // ساخت کنترل‌های موجودی سایزها همراه با دکمه‌ها
      Object.entries(manto.sizes).forEach(([size, count]) => {
        const div = document.createElement("div");
        div.innerHTML = `
          سایز ${size}: <span id="count-${size}">${count}</span>
          <button type="button" data-size="${size}" class="dec-btn">-</button>
          <button type="button" data-size="${size}" class="inc-btn">+</button>
        `;
        sizeControls.appendChild(div);
      });

      // اضافه کردن event به دکمه‌های کاهش
      sizeControls.querySelectorAll(".dec-btn").forEach(btn => {
        btn.onclick = () => {
          const s = btn.getAttribute("data-size");
          if (manto.sizes[s] > 0) {
            manto.sizes[s]--;
            sizeControls.querySelector(`#count-${s}`).textContent = manto.sizes[s];
          }
        };
      });

      // اضافه کردن event به دکمه‌های افزایش
      sizeControls.querySelectorAll(".inc-btn").forEach(btn => {
        btn.onclick = () => {
          const s = btn.getAttribute("data-size");
          manto.sizes[s]++;
          sizeControls.querySelector(`#count-${s}`).textContent = manto.sizes[s];
        };
      });
    });

    // ثبت تغییرات موجودی در بخش مدیریت
    saveChangesBtn.addEventListener("click", () => {
      alert("تغییرات ثبت شد.");
      showMantos();
    });

    // هنگام تغییر چک‌باکس‌ها یا رنگ، فیلترها را به روز کن
    sizeCheckboxes.addEventListener("change", showMantos);
    colorFilter.addEventListener("change", showMantos);

  </script>

</body>
</html>
